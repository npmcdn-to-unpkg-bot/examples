<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Example - example-componentRouter-production</title>
<style>
h1 {color: #369; font-family: Arial, Helvetica, sans-serif; font-size: 250%;}
h2 { color: #369; font-family: Arial, Helvetica, sans-serif;  }
h3 { color: #444; font-weight: lighter; }
body { margin: 2em; }
body, input[text], button { color: #888; font-family: Cambria, Georgia; }
button {padding: 0.2em; font-size: 14px}

ul {list-style-type: none; margin-left: 1em; padding: 0; width: 20em;}

li { cursor: pointer; position: relative; left: 0; transition: all 0.2s ease; }
li:hover {color: #369; background-color: #EEE; left: .2em;}

/* route-link anchor tags */
a {padding: 5px; text-decoration: none; font-family: Arial, Helvetica, sans-serif; }
a:visited, a:link {color: #444;}
a:hover {color: white; background-color: #1171a3; }
a.router-link-active {color: white; background-color: #52b9e9; }

.selected { background-color: #EEE; color: #369; }

.badge {
  font-size: small;
  color: white;
  padding: 0.1em 0.7em;
  background-color: #369;
  line-height: 1em;
  position: relative;
  left: -1px;
  top: -1px;
}

crisis-detail input {
  width: 20em;
}
</style>

<script type="text/javascript" src="../../../target/classes/alljs.js"></script>
<script type="text/javascript">
var m = require(["jquery", "ang"], function($, m) {
	var log = m["log"];
	var app = angular.module('app', []);
	
	app.component("app", { 
		template: "<button ng-click='$ctrl.clicked()'>Push me</button>",
		controller: [function() {
			var count = 0;
			this.clicked = function() {
				log("pushed ", ++count);
			}
		}]
	});
	
	app.service("logger", [ function() {
		var that = this;
		that.maxLines = 10;
		that.items = [];
		
		that.isEmpty = function() {
			return that.items.length == 0;
		};

		that.clear = function() {
			that.items.slipce(0, that.items.length);
		};
		
		that.stringify = function(obj) {
			seen = [];
			return JSON.stringify(obj, function(key, val) {
				if (val != null && typeof val === "object") {
					if (seen.indexOf(val) >= 0) {
						return "... cyclic ref ...";
					}
					seen.push(val);
				}
				return val;
			});
		};
		
		that.log = function() {
			var message = "";
			for (var i = 0; i < arguments.length; i++) {
				var a = arguments[i];
				if (typeof a !== "string")
					a = that.stringify(a);
				message = message + a;
			}
			that.items.push(message);
			console.log(message);
			var remove = that.items.length - that.maxLines;
			if (remove > 0) {
				that.items.splice(0, remove);
			}
		}
	}]);
	
	app.component("log", { 
		template: "<div ng-hide='$ctrl.isEmpty()' ng-repeat='item in $ctrl.items'><pre>{{item}}</pre></div>",
		controller: ["logger", function(logger) {
			this.items = logger.items;
			this.isEmpty = logger.isEmpty;
		}]
	});
/*
	app.run(["logger", function(logger) {
		log = logger.log;
		log('ho');
	}]);*/
	
	angular.bootstrap(document, ['app'], {
		strictDi: true,
	});

	
	log('hi');

	var injector = angular.element(document).injector();
	log = injector.get("logger").log;

	injector.invoke(["$rootScope", "logger", function($rootScope, logger) {
		$rootScope.$apply(function() {
			logger.log("ho");
		});
	}]);
/*
	injector.invoke(["$rootScope", function($rootScope) {
		$rootScope.$apply(function() {
			log("ho");
		});
	}]);*/
});
</script>
</head>
<body>
<h1 class="title">Component Router</h1>
<app></app>
<hr />
<log></log>
</body>
</html>
